<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ML Racer</title>
    <link rel="stylesheet" href="./styles/app.css" />
  </head>
  <body>
    <main class="app-shell">
      <header class="hero">
        <div>
          <h2 class="kicker">Created by Calvin Lomax</h2>
          <h1>ML1 Grand Prix - Train, Build, and Test Your Team with AI</h1>
          <p class="kicker">Coach your driver by adjusting the sliders below, save them to build your team!</p>
        </div>
        <div class="team-panel">
          <div class="team-panel-head">
            <span>Team Name</span>
            <button
              type="button"
              class="help-btn"
              data-help-section="team"
              aria-label="Team section help"
              title="Team section help"
            >
              ðŸ›ˆ
            </button>
          </div>
          <button id="team-name-display" type="button" class="team-name-btn">ML1 Academy</button>
          <input id="team-name-input" class="team-name-input" type="text" maxlength="48" autocomplete="off" hidden />
        </div>
      </header>

      <section class="surface canvas-surface" aria-label="Simulation">
        <div class="section-head">
          <h2>Viewer</h2>
          <button
            type="button"
            class="help-btn"
            data-help-section="viewer"
            aria-label="Viewer section help"
            title="Viewer section help"
          >
            ðŸ›ˆ
          </button>
        </div>
        <div class="canvas-frame">
          <canvas id="game-canvas" width="900" height="600" aria-label="Racing simulation canvas"></canvas>
        </div>
        <div class="hud" aria-live="polite">
          <div class="lap-summary">
            <div class="lap-metric"><span>Worst Lap:</span><strong id="stat-lap-worst">00:00:00</strong></div>
            <div class="lap-metric lap-count-metric">
              <div class="lap-count-row"><span>Laps:</span><strong id="stat-lap-count-current">0</strong></div>
              <div class="lap-count-row"><span>Best Laps:</span><strong id="stat-lap-count-best">0</strong></div>
            </div>
            <div class="lap-metric"><span>Best Lap:</span><strong id="stat-lap-best">00:00:00</strong></div>
          </div>
          <div class="hud-grid">
            <div class="hud-item"><span>Episode</span><strong id="stat-episode">1</strong></div>
            <div class="hud-item"><span>Step</span><strong id="stat-step">0</strong></div>
            <div class="hud-item"><span>Train Steps</span><strong id="stat-total-train">0</strong></div>
            <div class="hud-item"><span>Lap Progress</span><strong id="stat-progress">0.0%</strong></div>
            <div class="hud-item"><span>Reward</span><strong id="stat-reward">0.000</strong></div>
            <div class="hud-item"><span>Ep Return</span><strong id="stat-ep-return">0.000</strong></div>
            <div class="hud-item"><span>Best Return</span><strong id="stat-best-return">0.000</strong></div>
            <div class="hud-item"><span>Epsilon</span><strong id="stat-epsilon">1.000</strong></div>
            <div class="hud-item"><span>LR</span><strong id="stat-lr">0.00030</strong></div>
            <div class="hud-item"><span>Gamma</span><strong id="stat-gamma">0.990</strong></div>
            <div class="hud-item"><span>FPS</span><strong id="stat-fps">0.0</strong></div>
            <div class="hud-item"><span>Step ms</span><strong id="stat-step-ms">0.00</strong></div>
          </div>
          <section class="saved-racers" aria-label="Saved racers">
            <div class="saved-racers-head">
              <h3>Saved Racers</h3>
              <button
                type="button"
                class="help-btn"
                data-help-section="saved-racers"
                aria-label="Saved racers help"
                title="Saved racers help"
              >
                ðŸ›ˆ
              </button>
            </div>
            <div id="saved-racer-list" class="saved-racer-list"></div>
          </section>
        </div>
      </section>

      <section class="surface controls" aria-label="Controls">
        <div class="section-head">
          <h2>Controls</h2>
          <button
            type="button"
            class="help-btn"
            data-help-section="controls"
            aria-label="Controls section help"
            title="Controls section help"
          >
            ðŸ›ˆ
          </button>
        </div>
        <div class="button-row">
          <button id="start-pause-btn" class="primary">Start</button>
          <button id="step-btn">Step</button>
          <button id="episode-reset-btn">Episode reset</button>
        </div>
        <div class="button-row">
          <button id="new-track-btn">New track</button>
          <button id="new-racer-btn" class="danger">New racer</button>
        </div>
        <div class="button-row">
          <button id="change-car-btn">Change car</button>
          <button id="save-racer-btn" class="primary">save racer</button>
        </div>

        <div class="seed-row">
          <label for="seed-input">Track seed</label>
          <input id="seed-input" type="text" inputmode="numeric" maxlength="9" autocomplete="off" />
          <button id="apply-seed-btn">Apply seed</button>
        </div>

        <div class="toggle-row">
          <label><input id="toggle-sensors" type="checkbox" checked /> Show ray sensors</label>
          <label><input id="toggle-trail" type="checkbox" checked /> Show trajectory trail</label>
        </div>
      </section>

      <section class="surface training" aria-label="Training settings">
        <div class="training-head">
          <div class="section-head-inline">
            <h2>Training</h2>
            <button
              type="button"
              class="help-btn"
              data-help-section="training"
              aria-label="Training section help"
              title="Training section help"
            >
              ðŸ›ˆ
            </button>
          </div>
          <button id="reset-defaults-btn">Reset Defaults</button>
        </div>
        <p class="training-note">Epsilon decay is applied once at the end of each episode.</p>
        <div id="training-sliders" class="sliders"></div>
      </section>
    </main>

    <div id="confirm-modal-root" class="modal-root" hidden>
      <div class="modal-backdrop"></div>
      <div class="modal" role="dialog" aria-modal="true" aria-labelledby="modal-title" tabindex="-1">
        <h2 id="modal-title">Confirm action</h2>
        <p id="modal-message"></p>
        <div class="modal-actions">
          <button id="modal-cancel-btn">Cancel</button>
          <button id="modal-confirm-btn" class="danger">Confirm</button>
        </div>
      </div>
    </div>

    <div id="car-modal-root" class="modal-root" hidden>
      <div class="modal-backdrop"></div>
      <div class="modal car-modal" role="dialog" aria-modal="true" aria-labelledby="car-modal-title" tabindex="-1">
        <h2 id="car-modal-title">Change car</h2>
        <p>Pick a livery for your racer.</p>
        <div id="car-option-grid" class="car-option-grid"></div>
        <div class="modal-actions">
          <button id="car-modal-close-btn">Close</button>
        </div>
      </div>
    </div>

    <div id="racer-modal-root" class="modal-root" hidden>
      <div class="modal-backdrop"></div>
      <div class="modal" role="dialog" aria-modal="true" aria-labelledby="racer-modal-title" tabindex="-1">
        <h2 id="racer-modal-title">Save racer</h2>
        <p id="racer-modal-message"></p>
        <div class="field-stack">
          <label for="racer-name-input">Racer name</label>
          <input id="racer-name-input" type="text" maxlength="48" autocomplete="off" />
        </div>
        <div id="racer-car-field" class="field-stack" hidden>
          <label for="racer-car-select">Car color</label>
          <select id="racer-car-select"></select>
        </div>
        <div class="modal-actions">
          <button id="racer-modal-cancel-btn">Cancel</button>
          <button id="racer-modal-save-btn" class="primary">Save</button>
        </div>
      </div>
    </div>

    <div id="help-modal-root" class="modal-root" hidden>
      <div class="modal-backdrop"></div>
      <div class="modal help-modal" role="dialog" aria-modal="true" aria-labelledby="help-modal-title" tabindex="-1">
        <h2 id="help-modal-title">Section Help</h2>
        <div id="help-modal-body" class="help-modal-body"></div>
        <div class="modal-actions">
          <button id="help-modal-close-btn" class="primary">Close</button>
        </div>
      </div>
    </div>

    <script type="module" src="./src/main.js"></script>
  </body>
</html>
