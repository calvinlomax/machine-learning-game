<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ML Racer</title>
    <link rel="stylesheet" href="./styles/app.css" />
  </head>
  <body>
    <main class="app-shell">
      <header class="hero">
        <div>
          <h2 class="kicker">Created by Calvin Lomax</h2>
          <h1>ML1 Grand Prix - Train, Build, and Test Your Team with AI</h1>
          <p class="kicker">Tip: let the driver learn for a while before changing hyperparameters, it may surpise you.</p>
        </div>
      </header>

      <section class="surface canvas-surface" aria-label="Simulation">
        <div class="canvas-top-row">
          <div class="team-panel canvas-team-panel">
            <div class="team-panel-inline">
              <span class="team-panel-label">Team Name</span>
              <button id="team-name-display" type="button" class="team-name-btn">ML1 Academy</button>
              <input
                id="team-name-input"
                class="team-name-input"
                type="text"
                maxlength="48"
                autocomplete="off"
                hidden
              />
            </div>
          </div>
          <div class="train-speed-control" aria-label="Training speed">
            <label for="train-speed-slider">Training Speed</label>
            <div class="train-speed-field">
              <input id="train-speed-slider" type="range" min="1" max="25" step="1" value="1" />
              <output id="train-speed-value" for="train-speed-slider">1x</output>
            </div>
          </div>
        </div>
        <div class="canvas-frame">
          <canvas id="game-canvas" width="900" height="600" aria-label="Racing simulation canvas"></canvas>
        </div>
        <div id="draw-track-panel" class="draw-track-panel" hidden>
          <span id="draw-track-status">Draw mode: drag on canvas to sketch a closed track.</span>
          <button id="draw-track-finish-btn" type="button" class="primary">Finish shape</button>
          <button id="draw-track-cancel-btn" type="button">Cancel</button>
        </div>
        <div class="hud" aria-live="polite">
          <div class="lap-summary">
            <div class="lap-metric"><span>This Lap:</span><strong id="stat-lap-worst">00:00:00</strong></div>
            <div class="lap-metric lap-count-metric">
              <div class="lap-count-row"><span>Laps:</span><strong id="stat-lap-count-current">0</strong></div>
              <div class="lap-count-row"><span>Best Laps:</span><strong id="stat-lap-count-best">0</strong></div>
            </div>
            <div class="lap-metric"><span>Best Lap:</span><strong id="stat-lap-best">00:00:00</strong></div>
          </div>
          <div class="hud-grid">
            <div class="hud-item"><span>Episode</span><strong id="stat-episode">1</strong></div>
            <div class="hud-item"><span>Step</span><strong id="stat-step">0</strong></div>
            <div class="hud-item"><span>Train Steps</span><strong id="stat-total-train">0</strong></div>
            <div class="hud-item"><span>Lap Progress</span><strong id="stat-progress">0.0%</strong></div>
            <div class="hud-item"><span>Reward</span><strong id="stat-reward">0.000</strong></div>
            <div class="hud-item"><span>Ep Return</span><strong id="stat-ep-return">0.000</strong></div>
            <div class="hud-item"><span>Best Return</span><strong id="stat-best-return">0.000</strong></div>
            <div class="hud-item"><span>Epsilon</span><strong id="stat-epsilon">1.000</strong></div>
            <div class="hud-item"><span>LR</span><strong id="stat-lr">0.00030</strong></div>
            <div class="hud-item"><span>Gamma</span><strong id="stat-gamma">0.990</strong></div>
            <div class="hud-item"><span>FPS</span><strong id="stat-fps">0.0</strong></div>
            <div class="hud-item"><span>Step ms</span><strong id="stat-step-ms">0.00</strong></div>
          </div>
          <section class="saved-racers" aria-label="Saved racers">
            <h3>Saved Racers</h3>
            <div id="saved-racer-list" class="saved-racer-list"></div>
          </section>
          <section class="saved-tracks" aria-label="Saved tracks">
            <h3>Saved Tracks</h3>
            <div id="saved-track-list" class="saved-track-list"></div>
          </section>
        </div>
      </section>

      <section class="surface controls" aria-label="Controls">
        <h2>Controls</h2>
        <div class="button-row">
          <button id="start-pause-btn" class="primary">Start</button>
          <button id="step-btn">Step</button>
          <button id="episode-reset-btn">Episode Reset</button>
        </div>
        <div class="button-row">
          <button id="new-track-btn">New Track</button>
          <button id="new-racer-btn" class="danger">New Racer</button>
        </div>
        <div class="button-row">
          <button id="change-car-btn">Edit Livery</button>
          <button id="save-racer-btn" class="primary">Save Racer</button>
        </div>
        <div class="button-row">
          <button id="settings-btn">Settings</button>
          <button id="share-btn" class="primary">Share</button>
        </div>

        <div class="toggle-row">
          <label><input id="toggle-sensors" type="checkbox" checked /> Show ray sensors</label>
          <label><input id="toggle-trail" type="checkbox" checked /> Show trajectory trail</label>
        </div>
      </section>

      <section class="surface training" aria-label="Training settings">
        <div class="training-head">
          <h2>Training</h2>
          <button id="reset-defaults-btn">Reset Defaults</button>
        </div>
        <p class="training-note">Epsilon decay is applied once at the end of each episode.</p>
        <div id="training-sliders" class="sliders"></div>
      </section>
    </main>

    <div id="confirm-modal-root" class="modal-root" hidden>
      <div class="modal-backdrop"></div>
      <div class="modal" role="dialog" aria-modal="true" aria-labelledby="modal-title" tabindex="-1">
        <h2 id="modal-title">Confirm action</h2>
        <p id="modal-message"></p>
        <div class="modal-actions">
          <button id="modal-cancel-btn">Cancel</button>
          <button id="modal-confirm-btn" class="danger">Confirm</button>
        </div>
      </div>
    </div>

    <div id="car-modal-root" class="modal-root" hidden>
      <div class="modal-backdrop"></div>
      <div class="modal car-modal" role="dialog" aria-modal="true" aria-labelledby="car-modal-title" tabindex="-1">
        <h2 id="car-modal-title">Change car</h2>
        <p>Pick a livery for your racer.</p>
        <div id="car-option-grid" class="car-option-grid"></div>
        <div class="modal-actions">
          <button id="car-modal-close-btn">Close</button>
        </div>
      </div>
    </div>

    <div id="track-modal-root" class="modal-root" hidden>
      <div class="modal-backdrop"></div>
      <div class="modal track-modal" role="dialog" aria-modal="true" aria-labelledby="track-modal-title" tabindex="-1">
        <h2 id="track-modal-title">Add Track</h2>
        <p>Select a preset, draw a shape, enter a seed, or create a random track.</p>
        <div id="track-preset-grid" class="track-preset-grid"></div>
        <div class="track-shape-row">
          <button id="draw-track-btn" type="button">Draw shape</button>
          <button id="save-track-btn" type="button">Save This Track</button>
        </div>
        <div class="field-stack">
          <label for="seed-input">Track seed</label>
          <input id="seed-input" type="text" inputmode="numeric" maxlength="9" autocomplete="off" />
        </div>
        <div class="track-modal-actions">
          <button id="apply-seed-btn" class="primary">Apply seed</button>
          <button id="track-random-btn">Random Track</button>
        </div>
        <div class="modal-actions">
          <button id="track-modal-close-btn">Close</button>
        </div>
      </div>
    </div>

    <div id="settings-modal-root" class="modal-root" hidden>
      <div class="modal-backdrop"></div>
      <div class="modal settings-modal" role="dialog" aria-modal="true" aria-labelledby="settings-modal-title" tabindex="-1">
        <div class="settings-modal-head">
          <h2 id="settings-modal-title">Settings</h2>
          <button id="settings-help-btn" class="help-btn" type="button" aria-label="Settings help">&#x1F6C8;</button>
        </div>
        <div id="settings-help-pop" class="settings-help-pop" hidden>
          <p>Track size changes both world size and canvas dimensions.</p>
          <p>Track width/color affect the generated road appearance.</p>
          <p>Canvas background controls base color and pattern.</p>
          <p>UI style switches between light and dark themes.</p>
        </div>

        <div class="settings-grid">
          <label for="settings-world-width">Track width (px)</label>
          <input id="settings-world-width" type="number" min="480" max="1600" step="10" />

          <label for="settings-world-height">Track height (px)</label>
          <input id="settings-world-height" type="number" min="320" max="1200" step="10" />

          <label for="settings-track-width">Road width</label>
          <div class="range-with-value">
            <input id="settings-track-width" type="range" min="80" max="150" step="1" />
            <output id="settings-track-width-value"></output>
          </div>

          <label for="settings-track-color">Track color</label>
          <input id="settings-track-color" type="color" />

          <label for="settings-canvas-bg">Canvas background</label>
          <input id="settings-canvas-bg" type="color" />

          <label for="settings-canvas-pattern">Canvas pattern</label>
          <select id="settings-canvas-pattern">
            <option value="diagonal">Diagonal</option>
            <option value="grid">Grid</option>
            <option value="dots">Dots</option>
            <option value="solid">Solid</option>
          </select>

          <label for="settings-ui-theme">UI style</label>
          <select id="settings-ui-theme">
            <option value="light">Light</option>
            <option value="dark">Dark</option>
          </select>
        </div>
        <div class="modal-actions">
          <button id="settings-cancel-btn" type="button">Cancel</button>
          <button id="settings-apply-btn" type="button" class="primary">Apply</button>
        </div>
      </div>
    </div>

    <div id="racer-modal-root" class="modal-root" hidden>
      <div class="modal-backdrop"></div>
      <div class="modal" role="dialog" aria-modal="true" aria-labelledby="racer-modal-title" tabindex="-1">
        <h2 id="racer-modal-title">Save racer</h2>
        <p id="racer-modal-message"></p>
        <div class="field-stack">
          <label for="racer-name-input">Racer name</label>
          <input id="racer-name-input" type="text" maxlength="48" autocomplete="off" />
        </div>
        <div id="racer-car-field" class="field-stack" hidden>
          <label for="racer-car-select">Car color</label>
          <select id="racer-car-select"></select>
        </div>
        <div class="modal-actions">
          <button id="racer-modal-cancel-btn">Cancel</button>
          <button id="racer-modal-save-btn" class="primary">Save</button>
        </div>
      </div>
    </div>

    <script type="module" src="./src/main.js?v=tracks-save-20260227"></script>
  </body>
</html>
